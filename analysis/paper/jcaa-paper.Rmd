---
title: "Tool-driven Revolutions in Archaeological Science"
author:
  - Sophie C. Schmidt
  - Ben Marwick
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
    bookdown::word_document2:
      fig_caption: yes
      reference_docx: "../templates/template.docx" # Insert path for the DOCX file
bibliography: references.bib
csl: ../templates/harvard-european-archaeology.csl
abstract: "*Abstract* \n There is an argument in philosophy of science that revolutions in science are either idea-driven or tool-driven. We explore this debate in light of recent efforts by many scientific disciplines to embrace methods to improve the reproducibility of their research. One of the most profound changes driven by this concern for reproducibility and transparency is from analysing data using tools dependent on point-and-clicking with a mouse in closed source software, to tools based on writing scripts in open source programming languages and making them openly available. We present bibliometric evidence for this change in ecology and in archaeology to test if the adoption of these new tools is revolutionary or transformational. We identify a positive citation effect for papers that use the open source programming language R. We discuss how computational approaches to improving reproducibility and transparency in archaeology are mediated and transformed by the use of R code."
keywords: philosophy of science, reproducibility, programming language R, computational archaeology, open science
---



```{r, setup, echo = FALSE, message = FALSE, warning = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  cache = FALSE,
  comment = "#>",
  fig.path = "../figures/"
)

library(ggrepel)
library(tidyverse)
library(glue)
library(tidytext)
library(scales)
library(ggpmisc)
library(Hmisc)
```

# 1. Introduction

In this paper we investigate recent developments which are facilitating computational archaeology's return to fundamental principles of the scientific method. We ask whether this might be the beginning of a broader change in the field. Revolutions or paradigm-shifts in archaeology have been proposed to occur following major theoretical statements [@Clark_1993; @Härke_2002], but there is an argument among philosophers of science whether revolutions in science are idea-driven or tool-driven [@Galison_1997; @Dyson_2000]. This argument motivated us to explore how the disciplines of ecology and archaeology have started to embrace tools that improve the reproducibility of research. We focus on one set of tools for this change, based on writing data analysis scripts in free and open source programming languages, exemplified by R, and the practice of sharing of these scripts. We focus on R because our prior observations indicate it is by far the most common scripting language used by ecologists and archaeologists. Bibliometric evidence shows a strong increase in the use of R among ecologists and the beginning of a similar development in archaeology. We evaluate how approaches to improving reproducibility and transparency in archaeology are mediated and transformed by digital approaches and propose these might reflect a tool-driven change in archaeology. Acknowledging that this is not a simple process, we offer an R-based tool to ease the task of creating a compendium which enables other researchers to reproduce the published results.

# 2. Revolutions in Science: Idea-driven or Tool-driven?

Philosophers of science disagree whether revolutions in science are idea-driven or tool-driven. One of the most widely-known models of idea-driven change in science is Kuhn's [-@Kuhn_1962] effort to describe the history of science by proposing paradigm shifts resulting from revolutionary change in communities of researchers. In brief, this model proposes that the history of science consists of long periods of tradition-bound 'normal science' punctuated by short episodes of 'revolution'. Normal science was described by Kuhn as stagnant, routine day-to-day research focused on 'puzzle solving'. What counts as suitable puzzles, and acceptable solutions to these puzzles, is governed by the norms and procedures of the prevailing paradigm. Revolutions in science occur as punctuations in the equilibria of normal science, when anomalous observations culminate in changes replacing one paradigm with another. In this conversion or speciation process the community adopts a new way of doing science. There has been much debate about how to draw a distinction between so-called normal and revolutionary science. [@watkins1970against; @toulmin1970does; @Casadevalle00158_16]. A notable criticism is that Kuhn's normal science is unscientific, as it describes a situation where critical science had contracted into defensive metaphysics resulting from the domination of a ruling dogma [@popper1970]. This is at odds with a view of science as a continuous state of evolution, with researchers simultaneously employing many styles of thinking and doing science, and continuously confronting theory with evidence and modifying their ideas based on the outcome. In this view, based on the post-World War II era of science, radical discontinuities are rare, and major developments instead emerge from the division and recombination of already mature fields [@andersen2013second]. Given the rarity of radical discontinuities, some biologists have argued that change in biology is better characterised by new ideas (e.g. Mendelian heredity, Darwinian evolution, and molecular genetics) replacing not a former paradigm, but a conceptual vacuum [@wilkins1996are].

In archaeology we have seen claims for paradigm shifts in several areas. The most wide-ranging application is Clark's [-@Clark_1993] comparison of North American archaeology to European archaeology during the 1970s-1990s. His analysis describes a multi-paradigm situation where many research communities (i.e. North American and European) simultaneously operate in different paradigms (which Kuhn noted as a sign of a developing or immature discipline). Clark's account is not a complete Kuhnian analysis because it lacks a revolutionary change event where one paradigm is replaced by another, although he hints that processual archaeology may be considered a radical discontinuity relative to the culture-historical approaches that preceded it [@Clark_1993, pp. 206].

A more thorough treatment of the claim that the appearance of processual archaeology was a paradigm shift is provided by @Meltzer_1979. Meltzer reviews literature arguing for a revolutionary change in archaeology during the 1960s and 1970s, and considers these claims in light of classic Kuhnian revolutionary events such as the replacement of the Ptolemaic system by the Copernican system, and Newtonian dynamics by the new Einsteinian dynamics. He finds that the changes occuring in Anglophone archaeology after the 1960s were incremental, mostly of method, rather than a widespread replacement of one ontological structure by another one, incommensurable or incompatible with the former. Trigger [-@Trigger_2006, pp. 538] came to a similar conclusion at the end of his broad survey of the history of archaeology, that changes throughout archaeology have been mostly additive with only partial replacement.

We also see mentions of paradigm shifts in archaeology in reference to the shift from processual to post-processual archaeology [@Härke_2002; @Koerner_2018], as well as more localised and specific shifts in archaeological practice and thinking. For example, @Snodgrass_2002 claims that among Classical Archaeologists, an increase in research on previously neglected periods of antiquity, such as the Greek Early Iron Age, constitutes a paradigm shift. @McAnany_Rowe_2015 propose that the appearance of community-based participatory models of research among some communities of archaeologists is a paradigm shift, though they concede that it is transformational rather than revolutionary. @harris2012interfacing similarly argues that community crowdsourced geographic knowledge (or volunteered geographic information) could be paradigm shift for archaeological communities. Archaeologists using LIDAR (light detection and ranging) for remote geospatial imaging of cultural landscapes have claimed the application of this technology to archaeology is a paradigm shift [@chase2012geospatial; @howey2016detecting]. @Fuller_2010 has used the term to describe a shift in thinking from the emergence of agriculture as a  'Neolithic Revolution' to a protracted and entangled process, happening several times independently. Most of these claims for  Kuhnian paradigm shifts differ in meaning, which highlights an important complication with using Kuhn's concept of a paradigm-shift, namely the multiple definitions of a paradigm in his writings.

Masterman [-@masterman1970does] has documented 21 different uses of 'paradigm' by Kuhn, which she organises into three groups. First is the metaphysical notion of a set of beliefs, and this is the sense dominating most of the commentary on Kuhn's model. Second is the sociological sense of scientific habits, the universally recognized scientific achievements that are the foundations of day-to-day normal science. These include specific attention-grabbing successes that give a touchstone for the coordination of future research. Third is the concrete sense of an actual textbook, instrumentation or toolkit in wide use. This recognition of the multivalent nature of paradigms is important because it broadens the locus for scientific revolution to include sociological practices of science, such as might be produced by changes in norms of publication and peer review, and to include the physical infrastructure -- tools -- of doing science, such as the technology for collecting and analysing data, and for communication and collaboration among researchers.

We see a compelling exploration of this third concrete sense of a paradigm in the work of @Galison_1997, who has offered a tool-driven view of change in research communities. Galison analysed the role of tools in twentieth century particle physics, starting with hand-crafted cloud chambers and bubble chambers and ending with digital counters, particle accelerators, and computers. He identifies a profound change in physics when analog devices producing pictures were superseded by digital devices producing numerical data. At the heart of this change is a shift from an intuitive approach, stimulated by visual and pictorial model-building to an approach based on logic, calculation, and demonstration. The changes are not purely at the points of data collection and analysis, but extend to the social and economic organisation of science, with new categories of physicists emerging, people who are not entirely experimenters and not entirely theorists. Dyson [-@Dyson_2000; -@dyson2012science] has further explored this tool-driven approach, tracing the origin of the Galilean revolution to appearance of the telescope in astronomy, and the origin of the Crick-Watson revolution to the use of X-ray diffraction.

We propose that Galison's emphasis on tool-driven change, as a complement to Kuhnian concept-driven change, has potential to enhance archaeology's social and scientific relevance and contributions. The centrality of material culture in Galison's view raises the question about whether there is scope for archaeologists to make productive contributions to understanding change in the history of science through an archaeological analysis of scientific instrumentation [cf. @Schiffer_2013]. Furthermore, Galison's analysis of the image/logic contrast in the history of physics invites a similar analysis of the history of archaeology. Can we identify archaeological traditions focused on data collection and analysis using images and image-making devices [cf. @molyneaux2013cultural], in contrast to digital devices [@marwick_2019]? One candidate for this might be the shift from building relative chronologies based on seriation using typologies of visually distinctive artefacts to absolute chronologies based on radiometric dating using computer-controlled instruments. Three revolutions in archaeology have been attributed to radiocarbon dating and associated technologies [@bayliss2009rolling]. @chase2012geospatial have claimed the introduction of radiocarbon dating was a paradigm shift in archaeology, but we are not aware of a Galisonian analysis of this change. A third issue is how we can use a tool-driven approach not just as a framework for understanding change in science, but as a method to predict or generate change in the practice of archaeology?

# 3. Bibliometric Analysis of a Tool-driven Change

In this section we explore how a change observed in ecology might be relevant for understanding or even directing the future of archaeology. Biological disciplines have a long tradition of influencing archaeological thought, starting with Oscar Montelius, whose typological method was inspired by Darwin's theory of evolution [@Montelius_1899, 237]. This tradition continues, for example, many spatial statistics currently used by archaeologists are derived from ecology [@keron_use_2015, 7].

## 3.1 Looking back on a tool-driven change in Ecology

@Touchon_McCoy_2016 investigated evaluated changes in statistical methods used by ecologists as a potential area of tool-driven change. They searched nearly 20,000 published articles in ecology published between 1990 and 2013. They found that there has been a rise in complex and computationally intensive statistical techniques such as mixed effects models and Bayesian statistics and a decline in reliance on approaches such as ANOVA or t-tests. Crucially, they found that ecologists have shifted away from software tools such as SAS and SPSS to the open source program R.

@Touchon_McCoy_2016 identify four factors relating to technological change that might explain the changes they observed in the use of statistics in ecology. First, they note that automated data loggers, GPS trackers, remote sensing, and crowd sourcing have greatly increased the rate at which ecologists collect data. Second, increases in desktop and cluster computing power have made complex analytical processes faster and more convenient to compute. Third, the development of free, open source and easily extensible software for data analysis and visualisation, such as R, allows new methods to spread quickly via online fora and social media. Fourth, the publication of several books and papers that have strongly influenced the way many ecologists think about data analysis, such as Burnham and Anderson's [-@burnham2003model] book on model selection and inference.

We focus here on the third factor, free and open source software, because it is the most generic factor and so the most relevant beyond ecology. Archaeology and ecology each have a high diversity of data collection methods, and types of data analyses they conduct. An important similarity for the two disciplines is working with the field-collected data on a computer to prepare it for publication. R is a widely used free and open source data analysis tool in many research communities [@Tippmann_2015; @Baker_2017; @Thieme_2018]. Our observations suggest it is the dominant programming language in archaeology and ecology, so it is a good proxy for the adoption of open source scientific programming languages in these disciplines. To investigate changes in the use of R in archaeology and ecology, we obtained reference lists from a sample of scholarly articles in the Web of Science database and examined patterns in the citation of the R program over time.

```{r ecology-citing-r, echo=FALSE}


# We did a 'Cited Reference Search' in WoS for author: 

# "R DEV COR TEAM" OR "R # CORE" OR "R CORE TEAM" OR "R DEVELOPMENT CORE TEAM"

# which is the output from  `citation()`. 
# This function first appeared in 2004  https://github.com/wch/r-source/commits/9a5c086855d2e8fb07f670e3315871b2de31a4fd/src/library/base/inst/CITATION
#
# Note that before 2012 the authors were "R Development Core Team", and then it was simplified to "R Core Team" https://github.com/wch/r-source/commit/9a5c086855d2e8fb07f670e3315871b2de31a4fd#diff-80bb8a8b133a6204e9642d76791927e2
#
# we get  5,317 cited references, which are varients on how R is cited, we sort by 'citing articles', most cited at the top
# then 'select all' to get the first 1000 matches, then 'finish search'

# We select all to get 185,121 results, then refine...

# Results: 47,462
# (from Web of Science Core Collection)
# You searched for: CITED AUTHOR: ("R DEV COR TEAM" OR "R # CORE" OR "R CORE TEAM" OR "R DEVELOPMENT CORE TEAM")
# Refined by: WEB OF SCIENCE CATEGORIES: ( ECOLOGY OR ENVIRONMENTAL SCIENCES ) AND LANGUAGES: ( ENGLISH ) AND DOCUMENT TYPES: ( ARTICLE )
# Timespan: All years. Indexes: SCI-EXPANDED, SSCI, A&HCI, ESCI.

# Export to fast 5K...  tab-delimited Win
# 0. 1-5000 x
# 1. 5001-10000 x
# 2. 10001-15000 x
# 3. 15001-20000 x
# 4. 20001-25000 x
# 5. 25001-30000 x
# 6. 30001-35000 x
# 7. 35001-40000 x
# 8. 40001-45000 x
# 9. 45001-47538 x

# field tags
# TS= Topic
# TI= Title
# AU= Author [Index]
# AI= Author Identifiers
# GP= Group Author [Index]
# ED= Editor
# SO= Publication Name [Index]
# DO= DOI
# PY= Year Published
# AD= Address
# OG= Organization-Enhanced [Index]
# OO= Organization
# SG= Suborganization
# SA= Street Address
# CI= City
# PS= Province/State
# CU= Country/Region
# ZP= Zip/Postal Code
# FO= Funding Agency
# FG= Grant Number
# FT= Funding Text
# SU= Research Area
# WC= Web of Science Category
# IS= ISSN/ISBN
# UT= Accession Number
# PMID= PubMed ID

# ecology articles citing R
ecology_articles_citing_r_files <-
  list.files(here::here("/analysis/data/raw_data/post-review/ecology-articles-citing-R"),
             full.names = TRUE)

ecology_articles_citing_r <-
  map(ecology_articles_citing_r_files,
      ~readr::read_tsv(.x,
                       quote = "",
                       col_types = cols(.default = col_character()))) %>%
  bind_rows() %>%
  mutate(PY = as.numeric(PY)) %>%
  filter(PY <= 2018)

# limit to top journals
top_ecology_journals_for_cran_cites <-
  ecology_articles_citing_r %>%
  group_by(SO) %>%
  tally(sort = TRUE)

how_many_articles_in_top_journals_for_cran_cites <-
  sum(top_ecology_journals_for_cran_cites$n)

# this is a hand-collected spreadsheet of the total number 
# articles published in these journals. We get these from Web
# of Science 'publication name' search
top_journals_for_cran_cites_articles_per_year <-
  read_csv(str_glue('{here::here()}/analysis/data/raw_data/top_journals_for_cran_cites_articles_per_year.csv')) %>%
  select(-X1) %>%
  gather(variable, value, -year) %>%
  separate(variable,
           into = str_glue('X{1:4}'),
           sep = "_") %>%
  select(year, X4, value) %>% 
  mutate(year = as.integer(year)) %>% 
  rename( "journalname" = "X4", 
          'PY' = "year")

# tally by year
cran_cites_all_areas_top_ecol_journals_by_year <-
  ecology_articles_citing_r %>%
  filter(SO %in% top_ecology_journals_for_cran_cites$SO[1:10]) %>%
  group_by(SO, PY) %>%
  tally(sort = TRUE) %>%
  mutate(journalname = str_remove_all(SO, " |-"),
         PY = as.integer(PY)) %>%
  left_join(top_journals_for_cran_cites_articles_per_year) %>%
  mutate(prop = n / value ) %>%
  filter(SO != 'JOURNAL OF STATISTICAL SOFTWARE') %>%
  ungroup()

articles_shown_in_plot <-
  cran_cites_all_areas_top_ecol_journals_by_year %>%
  filter(!is.na(prop)) %>%
  summarise(sum_n = sum(n)) %>%
  pull(sum_n)

# nice labels with n for plot
cran_cites_all_areas_top_ecol_journals_by_year <-
  cran_cites_all_areas_top_ecol_journals_by_year %>%
  group_by(SO) %>%
  summarise(total_n_articles = sum(n)) %>%
  mutate(SO_n = as.character(glue('{SO} (n = {total_n_articles})'))) %>%
  right_join(cran_cites_all_areas_top_ecol_journals_by_year,
             by = "SO")

```

# 4. Methods

We used the 'Cited Reference Search' function provided by the Web of Science online scientific citation indexing service to find journal articles citing R. Although R has been available since the late 1990s [@Thieme_2018], a recommended format for citing the software did not appear until 2004, with the author given as "R Development Core Team". This recommended format for citing the software changed slightly in 2012 when the author was updated to "R Core Team". We searched the Web of Science using '"R DEV COR TEAM" OR "R CORE" OR "R CORE TEAM" OR "R DEVELOPMENT CORE TEAM"' in the CITED AUTHOR field of the Web of Science database. We sorted the results by frequency of citations, and selected the first 1000 items (the maximum allowed by the Web of Science service). These 1000 items represent variations on the recommended format for citing R. We found citations of R in the reference lists of `r prettyNum(how_many_articles_in_top_journals_for_cran_cites, ",")` English-language articles indexed by the Web of Science in the research area of 'Environmental Sciences Ecology'. We then downloaded the bibliographic data and reference lists for each of these articles.

## 4.1 Reproducibility and open source materials

To enable re-use of our materials and improve reproducibility and transparency according to the principles outlined in @Marwick2017, we include the entire R code used for all the analysis and visualizations contained in this paper at http://doi.org/10.17605/OSF.IO/RHVN5. Also in this version-controlled research compendium are the raw data for all the results reported here. All of the figures, tables and statistical test results presented here can be independently reproduced with the code and data in this repository. In our online materials our code is released under the MIT licence, our data as CC-0, and our figures as CC-BY, to enable maximum re-use [for more details, see @Marwick2017].

# 5. Results

Figure \@ref(fig:ecology-articles-citing-r-plot) shows the percentage of articles citing R in each of several of the top ecology journals (as defined by how often their articles are cited). We restrict the start of the observation period to 2008 for convenience so we have a ten year study period. The plot shows that the percentage of articles citing R has increased from less than ten percent in all journals in the late 2000s, to more than 30% in _Ecosphere_, _Ecology and Evolution_, and _Molecular Ecology_ after 2012. We might not call this a Kuhnian paradigm shift, but it does show a substantial change in the tools of the discipline, supporting claims for a Galisonian tool-driven change in ecology similar to the changes described by @Touchon_McCoy_2016.   

```{r ecology-articles-citing-r-plot, fig.cap=str_glue('Percentage of articles per year citing R in top Ecology journals ({prettyNum(articles_shown_in_plot,",")} articles out of {prettyNum(how_many_articles_in_top_journals_for_cran_cites,",")}). Data from Web of Science for 2008-2018')}

cran_cites_all_areas_top_ecol_journals_by_year <- 
  cran_cites_all_areas_top_ecol_journals_by_year %>% 
  mutate(SO_n = str_wrap(SO_n, 30))

min_y <- 2008
max_y <- 2030
eco_citing_R_over_time <-
  ggplot(cran_cites_all_areas_top_ecol_journals_by_year,
         aes(PY,
             prop,
             colour = SO)) +
   scale_color_viridis_d(option = "D") +
  geom_line(size = 2) +
  geom_text_repel(
    data = cran_cites_all_areas_top_ecol_journals_by_year %>% 
                  filter(PY == max(PY)),
    aes(label = SO_n),
    direction = "y",
    size = 4,
    nudge_x = 1,
    hjust = 0) +
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        axis.line = element_line(colour = "black"),
        axis.title.x = element_text(hjust = 0.125),
        legend.position="none",
        axis.text.x = element_text(angle = 90,
                                   hjust = 1,
                                   vjust = 0.5)) +
  scale_x_continuous(breaks = min_y:2018,
                     limits = c(min_y, max_y)) +
  scale_y_continuous(limits = c(0, 0.7)) +
  xlab("Publication year") +
  ylab("Proportion of articles in that journal in that year") +
  lemon::coord_capped_cart(bottom='right') 


ggsave(plot = eco_citing_R_over_time,
       filename = "eco_citing_R_over_time.png",
       path = str_glue('{here::here()}/analysis/figures'),
       height = 5,
       width = 7)

knitr::include_graphics(str_glue('{here::here()}/analysis/figures/eco_citing_R_over_time.png'))
```

## 5.1 Looking forward to a tool-driven change in Archaeology

```{r top-archaeology-journals-by-citations-of-r}

# Data are from an 'advanced search' of apps.webofknowledge.com using WC=Archaeology on apps.webofknowledge.com.

# Results: 44,047
# (from Web of Science Core Collection)
# You searched for: (WC=Archaeology) AND LANGUAGE: (English) AND DOCUMENT TYPES: # (Article)
# Timespan: 1900-2018. Indexes: SCI-EXPANDED, SSCI, A&HCI, ESCI

#- get journals with the most number of articles

archy_files <-
    list.files(here::here("/analysis/data/raw_data/post-review/archy-articles-in-wos"),
               full.names = TRUE)

archy_all_years <-
  map(archy_files,
      ~readr::read_tsv(.x,
                       quote = "",
                       col_types = cols(.default = col_character()))) %>%
  bind_rows() %>%
  mutate(PY = as.numeric(PY)) %>%
  filter(PY <= 2017) %>% 
  mutate(SO = ifelse(SO == "ASIAN PERSPECTIVES-THE JOURNAL OF ARCHAEOLOGY FOR ASIA AND THE PACIFIC",
                     "ASIAN PERSPECTIVES", SO)) %>% 
  mutate(SO = ifelse(SO == "GEOARCHAEOLOGY-AN INTERNATIONAL JOURNAL",
                     "GEOARCHAEOLOGY", SO)) %>% 
  mutate(SO = ifelse(SO == "AZANIA-ARCHAEOLOGICAL RESEARCH IN AFRICA" ,
                     "AZANIA", SO))

# limit to top journals
top_journals_for_archy<-
  archy_all_years %>%
  group_by(SO) %>%
  tally(sort = TRUE)

# n articles in top journals per year
top_journals_for_archy_per_year <-
  archy_all_years %>%
  group_by(SO, PY) %>%
  tally() %>%
  arrange(PY)

how_many_articles_in_top_archy_journals <-
  sum(top_journals_for_archy$n)

#-- get articles citing R that are archaeology

# We did a 'Cited Reference Search' in WoS for author: 

# "R DEV COR TEAM" OR "R # CORE" OR "R CORE TEAM" OR "R DEVELOPMENT CORE TEAM"

# which is the output from  `citation()`. 
# This function first appeared in 2004 https://github.com/wch/r-source/commits/9a5c086855d2e8fb07f670e3315871b2de31a4fd/src/library/base/inst/CITATION
#
# Note that before 2012 the authors were "R Development Core Team", and then it was simplified to "R Core Team" https://github.com/wch/r-source/commit/9a5c086855d2e8fb07f670e3315871b2de31a4fd#diff-80bb8a8b133a6204e9642d76791927e2
#
# we get  5,317 cited references, which are varients on how R is cited, we sort by 'citing articles', most cited at the top
# then 'select all' to get the first 1000 matches, then 'finish search'

# We select all to get 185,121 results, then refine...
# WOS research area "Archaeology" 

# Results: 
# (from Web of Science Core Collection)
# You searched for: CITED AUTHOR: ("R DEV COR TEAM" OR "R # CORE" OR "R CORE TEAM" OR "R DEVELOPMENT CORE TEAM")
# Refined by: LANGUAGES: ( ENGLISH ) AND DOCUMENT TYPES: ( ARTICLE ) AND RESEARCH AREAS: ( ARCHAEOLOGY )
# Timespan: All years. Indexes: SCI-EXPANDED, SSCI, A&HCI, ESCI.

# Export to fast 5K...  tab-delimited Win

# Results: 262

archy_cran_files <-
  list.files(here::here("/analysis/data/raw_data/post-review/archy-articles-citing-R"),
             full.names = TRUE)

archy_cran_all_years <-
  map(archy_cran_files,
      ~readr::read_tsv(.x,
                       quote = "",
                       col_types = cols(.default = col_character()))) %>%
  bind_rows() %>%
  mutate(PY = as.numeric(PY)) %>%
  filter(PY <= 2018) %>% 
  mutate(SO = ifelse(SO == "ASIAN PERSPECTIVES-THE JOURNAL OF ARCHAEOLOGY FOR ASIA AND THE PACIFIC",
                     "ASIAN PERSPECTIVES", SO)) %>% 
  mutate(SO = ifelse(SO == "GEOARCHAEOLOGY-AN INTERNATIONAL JOURNAL",
                     "GEOARCHAEOLOGY", SO)) %>% 
  mutate(SO = ifelse(SO == "AZANIA-ARCHAEOLOGICAL RESEARCH IN AFRICA" ,
                     "AZANIA", SO))

# tally by year
archy_cran_cites_all_areas_top_journals_by_year <-
  archy_cran_all_years %>%
  filter(SO %in% {archy_cran_all_years %>% 
           count(SO, sort = TRUE)  %>% 
           slice(1:25) %>% 
           pull(SO)}
         ) %>%
  group_by(SO, PY) %>%
  tally(sort = TRUE)  %>%
  left_join(top_journals_for_archy_per_year,
            by = c('SO', 'PY')) %>%
  mutate(prop = n.x / n.y) %>%
  ungroup() %>% 
  filter(!is.na(prop))

total_number_archaeology_articles_citing_r <- sum(archy_cran_cites_all_areas_top_journals_by_year$n.x, na.rm = TRUE)

# check for slight differences in journal names
# sort(unique(archy_cran_cites_all_areas_top_journals_by_year$SO))

# nice labels with n for plot
archy_cran_cites_all_areas_top_journals_by_year <-
  archy_cran_cites_all_areas_top_journals_by_year %>%
  group_by(SO) %>%
  summarise(total_n_articles = sum(n.x)) %>%
  mutate(SO_n = as.character(glue('{SO} (n = {total_n_articles})'))) %>%
  right_join(archy_cran_cites_all_areas_top_journals_by_year,
             by = "SO")

min_y <- 2008
max_y <- 2021
label_text_size = 4

archy_cran_cites_all_areas_top_journals_by_year_to_plot <- 
  archy_cran_cites_all_areas_top_journals_by_year %>%
  filter(total_n_articles > 5)
# %>% 
# filter(SO != "AFRICAN ARCHAEOLOGICAL REVIEW") 

all_archaeology_citing_R_over_time <-
  ggplot(archy_cran_cites_all_areas_top_journals_by_year_to_plot,
         aes(PY,
             prop,
             colour = SO)) +
  scale_color_viridis_d(option = "D") +
  scale_x_continuous(breaks = min_y:2018,
                     limits = c(min_y, max_y)) +
  scale_y_continuous(limits = c(0, 0.2)) +
  geom_line(size = 2) +
  geom_point() +
  geom_text_repel(
    data = archy_cran_cites_all_areas_top_journals_by_year_to_plot %>%
      group_by(SO) %>%
      slice(which.max(PY)) %>% 
      ungroup() %>% 
      top_n(5, total_n_articles) %>% 
      mutate(SO_n = str_wrap(SO_n, 30)),
    aes(label = SO_n),
    hjust = -1,
    direction = "y",
    size = label_text_size,
    nudge_x = 5) +
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        axis.line = element_line(colour = "black"),
        axis.title.x = element_text(hjust = 0.4),
        legend.position="none",
        axis.text.x = element_text(angle = 90,
                                   hjust = 1,
                                   vjust = 0.5)) +
  xlab("Publication year") +
  ylab("Proportion of articles in that journal") +
  lemon::coord_capped_cart(bottom='right') 

ggsave(plot = all_archaeology_citing_R_over_time,
       filename = "all_archaeology_citing_R_over_time.png",
       path = str_glue('{here::here()}/analysis/figures'),
       height = 7,
       width = 7)
```



```{r j-arch-sci-articles-citing-R}
# look at the trend in JAS, where there are the most articles

how_many_articles_in_jas <-  
  archy_cran_cites_all_areas_top_journals_by_year$total_n_articles[1]

labels_and_breaks <- 
  sort(unique(archy_cran_cites_all_areas_top_journals_by_year$PY))

jas_cites_r <-
archy_cran_cites_all_areas_top_journals_by_year %>%
  filter(SO == "JOURNAL OF ARCHAEOLOGICAL SCIENCE") %>%
  ggplot(aes(PY,
           prop)) +
  geom_point(size = 4) +
  geom_smooth(method = "lm",
              se = FALSE) +
  stat_poly_eq(aes(label =  paste(..eq.label..,
                                  ..adj.rr.label..,
                                  sep = "~~~~")),
               formula = y~x,
               parse = TRUE,
              label.y = 0.9) +
 stat_fit_glance(method = "lm", 
                  label.y = 0.8,
                  method.args = list(formula = y~x),
                  aes(label = paste("italic(P)*\"-value = \"*", 
                                    signif(..p.value.., digits = 4), sep = "")),
                  parse = TRUE) +
  xlab("year") +
  scale_x_continuous(breaks = labels_and_breaks,
                     labels = labels_and_breaks) +
  ylab("Proportion of articles citing R per year") +
  theme_bw(base_size = 14) +
  theme(axis.text.x = element_text(angle = 90,
                                   hjust = 1,
                                   vjust = 0.5))

ggsave(plot = jas_cites_r,
       filename = "jas_cites_r.png",
       path = str_glue('{here::here()}/analysis/figures'),
       height = 7,
       width = 11)
```

To compare with ecology we conducted a similar bibliometric analysis for archaeology journals indexed by the Web of Science service. We used the 'Cited Reference Search' to find articles citing R in the same way as above, and then refined the results to keep only those articles published during 2008-2018 that are included in the Web of Science category 'Archaeology'. This resulted in `r prettyNum(how_many_articles_in_top_archy_journals, ",")` articles, of which `r total_number_archaeology_articles_citing_r` cite R.Figure \@ref(fig:archaeology-journals-with-subplot) shows the temporal trend of citations of R in archaeological articles. There are three interesting details revealed by this figure.

```{r archaeology-journals-with-subplot, fig.cap=str_glue('Proportion of Archaeology articles per year citing R (a total of {total_number_archaeology_articles_citing_r} out of {prettyNum(how_many_articles_in_top_archy_journals, ",")} articles in our sample for 2008-2018). Labels to the right show the top five journals in our sample. Sub-plot shows articles published in the _Journal of Archaeological Science_ during 2008-2017. Data from Web of Science')}
# combine main plot and subplot
all_archaeology_citing_R_over_time_and_subplot <-
all_archaeology_citing_R_over_time  +
  annotation_custom(grob = ggplotGrob(jas_cites_r),
                          xmin = 2008, xmax = 2015,
                          ymin = 0.08, ymax = 0.20)
ggsave(plot = all_archaeology_citing_R_over_time_and_subplot,
       filename = "all_archaeology_citing_R_over_time_and_subplot.png",
       path = str_glue('{here::here()}/analysis/figures'),
       height = 9,
       width = 12)
knitr::include_graphics(str_glue('{here::here()}/analysis/figures/all_archaeology_citing_R_over_time_and_subplot.png'))
```

The first detail we see here is that overall, the proportions and the absolute number of articles citing R in archaeology are much smaller than what we see in the ecology journals in Figure \@ref(fig:ecology-articles-citing-r-plot). Only the _Journal of Archaeological Science_ has more than 50 articles in our sample. We conclude from this observation that archaeologists have yet to adopt programming for data analysis and visualisation in the same way ecologists have.

The second detail is that most archaeology journals do not show any strong increase in the percentage of article citing R over time. The ecology journals shown in Figure \@ref(fig:ecology-articles-citing-r-plot) show strong upward trends of increasing proportions of articles citing R over time, but we do not see any unambiguous trends in the archaeology articles when considered together. Indeed, in several of the other archaeological journals in our sample, the first citations of R only occurred in the last two years. The sample sizes for the archaeology journals are too small to confidently infer any trend of over time, with the exception of the _Journal of Archaeological Science_ with `r how_many_articles_in_jas` articles. Figure \@ref(fig:archaeology-journals-with-subplot) shows a statistical test of change over time for articles citing R in the _Journal of Archaeological Science_. With a moderate r-squared value and low p-value for the linear model, we conclude there is some evidence for a non-random increase in citations of R over time in this journal. This may show an increasing use of R among archaeologists, especially those working at the intersection of archaeology and the natural sciences. This may hint at the start of a trend like what we see in the ecology journals of a widespread adoption of R.

Following on from this observation about the increasing popularity of R in the _Journal of Archaeological Science_, the third detail we see in these results is the distinctive types of journals that have articles citing R. There is a focus on journals publishing scientific archaeology, especially those that focus on specialised empirical analysis. In addition to the general archaeology journals, we also see _Lithic Technology_, _Anthropozoologica_, and _International Journal of Osteology_ in the journal names, indicating that we find R used by specialists in stone artefacts and faunal remains. For more fine-grained insights into the topics that archaeologists are using R to study, we conducted a statistical analysis of the words in the titles of all the articles in our sample.

## 5.2 What are R-using archaeologists writing about?

```{r text-mining-article-titles-archaeology}

# https://www.tidytextmining.com/twitter.html

# These are all archy articles
# wc_archaeology_2007_to_2017

# These are ones citing R
# cran_cites_in_archy_journals

# subtract ones citing R from ones that do not

wc_archaeology_2007_to_2017_no_R_cites <-
  archy_all_years %>%
  filter(TI %nin% archy_cran_all_years$TI)

# combine
archy_journal_articles <-
  bind_rows(wc_archaeology_2007_to_2017_no_R_cites %>%
            mutate(ID = "no_R_cites",
                   VL = as.character(VL)),
           archy_cran_all_years %>%
            mutate(ID = "has_R_cites"))


tidy_cites <-
archy_journal_articles %>%
  unnest_tokens(word, TI) %>%
  filter(!word %in% c(stop_words$word, "archaeology",
                      "archaeological",
                      "analysis", "study", "site", "period", "past", "patterns", "investigation", "analyses", "late", "region", "based", "central", "north", "south", "east", "west", "western", "eastern", "ad", "pre", "sites", "evidence", "prehistoric", "remains", "change", "de", "identification", "northern", "southern", "valley", "implications", "valley", "history", "historical", "modern", "context", "stable", "middle", "approach", "san", "artifacts", "palaeolithic"),
         str_detect(word, "[a-z]"))

word_frequency <-
  tidy_cites %>%
  group_by(ID) %>%
  count(word, sort = TRUE) %>%
  left_join(tidy_cites %>%
              group_by(ID) %>%
              summarise(total = n())) %>%
  mutate(freq = n/total)

word_frequency <-
  word_frequency %>%
  select(ID, word, freq) %>%
  spread(ID, freq) %>%
  arrange(no_R_cites, has_R_cites)

hm_words <- prettyNum(nrow(word_frequency), big.mark  = ",")
hm_articles <- prettyNum(nrow(archy_journal_articles), big.mark  = ",")

```

We computed a comparison of word frequencies in journal article titles in the Web of Science data to get a better understanding of what topics archaeologists are writing about when they cite R. First we separated the archaeology articles into two groups, those that cite R, and those that do not. Second, we filtered to keep only words that occur in titles in both groups, and removed very common and uninformative words (e.g. 'the', 'archaeological', 'study', etc.). This resulted in `r hm_words` words in `r hm_articles` articles. Third, for each word found in all the titles of the journal articles in each group, we computed its proportion of the total number of words in all the titles in each group. Figure \@ref(fig:text-mining-article-titles-archaeology-plot) shows the results of this analysis. Words near the red line are used with about equal frequencies by papers citing R and by papers not citing R. Words far away from the red line are used much more by one group of articles compared to the other.

```{r text-mining-article-titles-archaeology-plot, fig.cap=str_glue("Comparing the frequency of words used in titles of archaeology articles ({hm_words} words in {hm_articles} articles)")}

archaeology_articles_word_freqs <-
ggplot(word_frequency,
       aes(no_R_cites,
           has_R_cites)) +
    geom_abline(color = "red",
              size = 1) +
  geom_point(alpha = 0.1,
              size = 2.5,
              width = 0.25,
              height = 0.25) +
  geom_text_repel(aes(label = word),
            size = 3,
            segment.colour = "grey80") +
  scale_x_log10(labels = percent_format(),
                limits = c(0.00075, 0.015)) +
  scale_y_log10(labels = percent_format(),
                limits = c(0.00075, 0.015)) +
  theme_minimal(base_size = 16) +
  xlab("Articles that do not cite R") +
  ylab("Articles that cite R") +
  coord_equal()

ggsave(plot = archaeology_articles_word_freqs,
       filename = "archaeology_articles_word_freqs.png",
       path = str_glue('{here::here()}/analysis/figures'),
       height = 9,
       width = 9)

knitr::include_graphics(str_glue('{here::here()}/analysis/figures/archaeology_articles_word_freqs.png'))
```

Figure \@ref(fig:text-mining-article-titles-archaeology-plot) supports our observation that archaeologists using R tend to be doing archaeology that involves the natural and physical sciences. Articles that cite R more often have titles that include terms such as 'lithic', 'experimental', and 'isotope'. On the other hand, articles that do not cite R more often discuss the Roman and Bronze Age periods, and less often reflect a technical specialisation. If there is one technical specialisation that is characteristic of articles that do not cite R, it seems to be in ceramics.  

## 5.3 From using code in research to sharing code with publications

```{r archaeology-reproducible-articles}

archy_ctv_readme <- readLines(str_glue('{here::here()}/analysis/data/raw_data/post-review/README.md'))

# get just the articles
archy_ctv_readme_start <- str_which(archy_ctv_readme, " Publications that include R code")
archy_ctv_readme <- 
  archy_ctv_readme[archy_ctv_readme_start:length(archy_ctv_readme)]

# get all dates of publication
archy_ctv_readme <- str_remove_all(archy_ctv_readme, "[[:punct:]]")
archy_ctv_readme_20XX <- str_extract(archy_ctv_readme, " 20[[:digit:]]{2} ")
archy_ctv_readme_20XX <- str_squish(unlist(archy_ctv_readme_20XX))
archy_ctv_readme_20XX <- as.numeric(archy_ctv_readme_20XX)
archy_ctv_readme_20XX <- archy_ctv_readme_20XX[!is.na(archy_ctv_readme_20XX)]

number_of_reproducible_articles <- length(archy_ctv_readme_20XX)

# get a few journal names
archy_ctv_readme_journals <- str_which(archy_ctv_readme, glue_collapse(archy_ctv_readme_20XX, "|"))
archy_ctv_readme_journals <- archy_ctv_readme[archy_ctv_readme_journals]

journals <- c("Journal of Archaeological Method and Theory|J Archaeol Sci|Journal of Anthropological Archaeology|Journal of Archaeological Science|PLOS|Journal of Human Evolution|Asian Perspectives|Scientific Reports|PLoS ONE|The Holocene|Archaeology in Oceania|Quaternary International|Internet Archaeology|Quaternary Science Reviews|Quaternary International|Journal of Archaeological Science: Reports|Open Quaternary|Evolution and Human Behavior|PaleoAnthropology|Archaeological and Anthropological Sciences")

top_archy_journals <-
  tibble( citation = archy_ctv_readme_journals, 
          year = archy_ctv_readme_20XX) %>% 
  mutate(journal_name = str_extract(tolower(citation), tolower(journals))) %>% 
  mutate(journal_name = ifelse(journal_name == "j archaeol sci",
                                  "journal of archaeological science",
                                  ifelse(journal_name == "plos",
                                  "plos one",
                                  journal_name))) %>% 
  mutate(journal_name = str_to_title(journal_name)) %>% 
  mutate(journal_name = str_replace(journal_name, "And", "and")) %>% 
  mutate(journal_name = str_replace(journal_name, "Of", "of")) %>% 
  mutate(journal_name = str_replace(journal_name, "In ", "in ")) %>% 
  mutate(journal_name = str_replace(journal_name, "Plos", "PLOS")) %>% 
  mutate(journal_name = str_replace_na(journal_name, "Other")) %>% 
  mutate(year = factor(year)) %>% 
  add_count(journal_name) %>% 
  mutate(journal_name = str_glue('{journal_name} (n = {n})'))
```

@Touchon_McCoy_2016 identified the use of scripting languages as being a factor for easily sharing methods and code, thereby increasing the rate of development of statistical methods. One notable practice we observed during our bibliometric analysis is that among authors of articles citing R, a subset of these authors publicly share the code and data that they used to generate the results presented in their article. We identified `r number_of_reproducible_articles` articles that include R script and data files, either in the supplementary materials or in a trustworthy data repository such as Zenodo, Open Science Framework, Figshare, etc. 'Trustworthy' data repositories are those hosted by a non-commercial organisation, offering persistent identifiers, and have transparent commmitments to long term data management and backup strategies (see @marwick_standard_2018 for more details). Our continuously updated list of articles in this sample is available online here: https://github.com/benmarwick/ctv-archaeology. Figure \@ref(fig:archaeology-reproducible-articles-plot) shows that although this number is small, it is increasing, hinting at the emergence of a new approach to how archaeologists share their research. The author guidelines of this journal support this trend: "In the interests of open scholarship and the reproducibility of results, JCAA strongly encourages all authors to deposit material relating to their publication in a preservation repository" [@authorguidelines_JCAA].

These archaeology articles that include publicly available R code and data are part of a shift in scientific communication that is also underway in other fields. For example, the journal *Nature Neuroscience* requires authors 'to make the code that supports the generation of key figures in their manuscript available for review' [@Editors_2017]. Although we are not aware of attempts to quantify this change in the same way we have for archaeology, we have observed a number of recent publications that describe and recommend code sharing in statistics [@Baumer2014], genome biology [@markowetz2015five], computational biology [@Sandve2013], hydrology [@Slater_et_al_2019], biostatistics [@Peng2009], computer science [@peng2011reproducible; @Mitchell2012], applied mathematics [@LeVeque2012], speech science [@Abari2012], political science [@king1995replication; @Dafoe2014], and the social sciences generally [@Miguel2014]. As part of this growing interest in using code for research we also see manifestos aimed at researchers doing any kind of quantitative work [@nosek2015promoting; @Ince2012; @Barnes2010] and articles recommending using R in undergraduate education [@Bray2014; @Eglen2009]. Much of this literature is concerned with identifying and solving problems of irreproducibility in research. These actions come from a renewed interest in basic principles of the scientific method: that once-off results should not be trusted, instead they should be reproducible by other members of the research community [@Stark_2018]. Furthermore, that an article should sufficiently describe the presented research results such that a colleague can fully understand the results and how they were obtained. Many of these authors trace problems of irreproducibility to the increased complexity of computer-based analyses, combined with the limited space to describe them in a journal article, and mouse-driven computer programs where the researcher's analytical decisions are not recorded during the research process, and thus cannot be shared with other researchers.

In our view, merely using R (or similar open source programming languages) to conduct research would not constitute a tool-driven revolution by itself, but publicly sharing the code used for research, as a solution to problems of irreproducibility, is more likely to lead to revolutionary change. We expect that openly shared code will speed the widespread adoption of reproducibility as a core tenet of the scientific process, since it frees researchers from the black box that most mouse-driven programs are, and enables researchers to not only rerun the shared analysis, but to gain access to all parameter settings, empowering them to change these and so properly evaluate, extend and reuse the published results. As open source languages such as R (and Python) are free to use, and many trustworthy repositories are also free (such as Zenodo, Open Science Framework, Figshare, etc.), then even researchers with limited resources anywhere in the world can contribute equally to the research community by using and sharing code. Using and sharing open source code is thus an important action for reducing inequality in the archaeological research community. It enables participation by researchers who are unable to buy software licenses.

```{r archaeology-reproducible-articles-plot, fig.cap=str_glue('Articles in archaeology journals using R for reproducible research, and making code files openly available to accompany the published article (n = {number_of_reproducible_articles})')}

archaeology_articles_r_reproducible <-
ggplot(top_archy_journals,
       aes(year,
           fill = journal_name)) +
  geom_bar(position = "stack") +
  scale_y_continuous(breaks = 1:30) +
  scale_fill_viridis_d(name = "Journal")  +
  xlab("Year of publication") +
  ylab("Number of articles") +
  theme_bw(base_size = 14) +
  theme(legend.text=element_text(size=14),
        axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5),
        legend.justification = c(0, 1), 
        legend.position = c(0.05, 0.98),
        legend.spacing.y = unit(0.65, 'cm'),
        legend.key.size = unit(0.65, "cm"))


ggsave(plot = archaeology_articles_r_reproducible,
       filename = "archaeology_articles_r_reproducible.png",
       path = str_glue('{here::here()}/analysis/figures'),
       height = 9,
       width = 16)
knitr::include_graphics( str_glue('{here::here()}/analysis/figures/archaeology_articles_r_reproducible.png'))
```

## 5.4 Citation effects of sharing code

A pragmatic issue for understanding widespread changes in scientific practice is to identify incentives for members of a research community to change. If code sharing has concrete career advantages, for example, if is known to result in increased citations, then we might expect it to be more likely to be part of a tool-driven revolution. @Vandewalle2012 analysed citation rates for 645 articles published in _IEEE Transactions on Image Processing_ during 2004–2006. He found non-random differences between the median number of citations for papers that have code available and papers that do not. In considering causal relationships, Vandewalle raises the possibility of self-selection bias, where authors include code more often with their best papers. He also notes that for some papers, the code was made available by researchers other than the authors, after the publication has become popular.

We conducted a similar analysis for archaeology articles using the Web of Science Core Collection 'Times Cited' ('TC') count (Figure \@ref(fig:citation-advantage-plot)). This Times Cited count displays the total number of times a published paper was cited by other papers within the Web of Science Core Collection. Unlike Google Scholar, this does not include citations on blogs, pre-prints and other places outside of journal articles, so the citation counts from Web of Science are lower than those on Google Scholar. We see that archaeological articles that cite R are consistently more highly cited themselves than articles that do not cite R. 

The mechanisms underlying the citation effects of using R remain to be elucidated. The articles in our data are mostly not open access (only 20% are open access), so we cannot attribute the citation effect to open access effects, such as easier availability, and additional time in press of the articles [@Kurtz_Eichhorn_Accomazzi_Grant_Demleitner_Henneken_Murray_2005]. In our data all the article authors are also the code authors, so there is no popularity effect noted by Vandewalle. One possibility is that authors preferentially tend to promote their articles containing code, because they want a greater return for the greater effort they have put into including the code with the article, this may be equivalent to the self-selection bias postulated by Vandewalle. Another possibility is that papers with code are perceived by readers to be more robust because of their transparency, and thus a more reliable and credible item to cite in support of knowledge claims. Another possible cause is that when a paper is accompanied by code (for example on a trustworthy repository) it is more visible than a paper without code, and appears higher in search result rankings. All other factors equal, higher visibility leads to more citations because the researcher will stop searching when they have found the first paper that serves their purpose. Further work is necessary to understand the mechanisms of this citation effect. Additional insights might come from comparisons of papers that use another open source language such as Python, or a closed source language like MATLAB.  

```{r citation-advantage}
# archy papers that use code are more often cited?
# is TC total citations?

archy_journal_articles_tally <-
archy_journal_articles %>%
  group_by(ID) %>%
  tally() %>%
  pull(n)

archy_journal_articles_citations <- 
archy_journal_articles %>%
  mutate(TC = as.numeric(TC),
         ID = ifelse(ID == "has_R_cites",
                     "Cites R", "Doesn't cite R")) %>%
  group_by(ID, PY) %>%
  summarise(median = median(TC)) %>%
  filter(PY >= 2010) %>% 
  filter(PY < 2018) 
  

archy_journal_articles_n <- 
archy_journal_articles %>%
  mutate(TC = as.numeric(TC),
         ID = ifelse(ID == "has_R_cites",
                     "Cites R", "Doesn't cite R")) %>%
  select(ID, PY, TC) %>% 
  filter(PY >= 2010) %>% 
  filter(PY < 2018) 
  
# compute t-test
archy_journal_articles_citations_t_test <- 
  t.test(  archy_journal_articles_n$TC ~  factor(archy_journal_articles_n$ID))

tt <- t.test(archy_journal_articles_n$TC ~  factor(archy_journal_articles_n$ID))
tvalue <- tt$statistic %>% formatC(digits = 2, format = "f")
pvalue <- tt$p.value %>% formatC(digits = 5, format = "f")
df <- round(tt$parameter, 0)

dd <- archy_journal_articles_n %>% 
  group_by(ID) %>% 
  summarise(mean = mean(TC))
dd_cites_mean <- dd %>% filter(ID == "Cites R") %>%  pull(mean) %>% round(1)
dd_no_cites_mean <- dd %>% filter(ID == "Doesn't cite R") %>%  pull(mean) %>% round(1) 
test_explanation <- 
str_glue("On average, articles citing R have higher numbers of citations (m = {dd_cites_mean}) than articles that do not (m =  {dd_no_cites_mean}) t({df}) = {tvalue}, p =  {pvalue}")

archy_journal_articles_citations_plot <- 
  ggplot(archy_journal_articles_citations,
         aes(ID,
             median, 
             fill = ID)) +
  geom_col() +
  scale_fill_viridis_d(
                    guide = FALSE) +
  facet_wrap( ~ PY) +
  theme_minimal(base_size = 16) +
  ylab("Median number of citations") +
  xlab("")

ggsave(plot = archy_journal_articles_citations_plot,
       filename = "archy_journal_articles_citations_plot.png",
       path = str_glue('{here::here()}/analysis/figures'),
       height = 9,
       width = 16)

```

```{r results='hide'}

```


```{r  citation-advantage-plot, fig.cap=str_glue('Median citation rates per year for archaeology articles 2010-2017 that cite R (n = {prettyNum(archy_journal_articles_tally[1], ",")}) and articles that do not cite R (n = {prettyNum(archy_journal_articles_tally[2], ",")}). {test_explanation}.')}
knitr::include_graphics(here::here("analysis", "figures", "archy_journal_articles_citations_plot.png"))
```

# 6. Discussion 

Our hypothesis is that a tool-driven change is underway in the biological sciences, and is emerging in archaeology. The tool which drives this change is the use of scripting languages in computational work in these disciplines. We have shown that the use of R is on the rise among archaeologists, especially those using natural science methods, and has concrete advantages for authors that publish papers that cite R. The advantage is that papers using and citing R tend to be referenced more often in other papers, giving the authors more visibility and influence (cf. Huggett in this volume for critical discussion of open scholarship). 

The use of R or similar scripting languages enables a major shift in the technical and social dynamics of the research community, as it offers the possibility to communicate one's workflow in a highly detailed and efficient way, and easily share this workflow with others. The sharing of code has been identified in other disciplines as an amplifier of change in methods [@Touchon_McCoy_2016]. It also enables researchers to not just reproduce the work of others, but to also thoroughly evaluate them. Thus, the sharing of code may be at the root of an upcoming tool-driven change for archaeology, consistent with the patterns described by @Galison_1997 [-@Galison_1997]. This change is transformational rather than revolutionary, enabling archaeologists to more faithfully adhere to a fundamental tenet of the scientific process which demands the reproducibility of results. We do not claim archaeologists did not want to produce reproducible research before the advance of scientific scripting languages. Indeed, there is a longstanding tradition in archaeology of publishing catalogues, lists and maps showing the data used for analyses. Empirical reproducibility has always been prominent in archaeological research as we can see from the value placed on re-examining museum collections, re-excavating old sites, and reusing previously published data [@Strupler_2017].

Nonetheless, with the introduction of computers there has been a gradual and unintended drift away from reproducibility [@brinckman2019computing; @bailey2016facilitating], and so from the fundamental tenets of scientific practice. Many archaeological tasks have shifted from the descriptive and qualitative aspects to quantitative and computational analyses. This shift also mandates a change in documentation of analyses to enable other researchers to reproduce published results. Modern archaeology has often been lacking in this aspect, as much research is  undertaken using point-and-click software, which obscures and complicates the reproducibility of analyses. By using and sharing code we can undo this drift, and return to a robust scientific practice for archaeology. As we show, the most frequent use of scripting languages takes place mostly in the part of archaeology that is in close contact with natural sciences. These sciences also show a trend of increased emphasis on reproducibility, with journals changing their data and code availability policies to require code and data to be peer reviewed and available alongside articles [@Stodden_2013]. Also in archaeology, funding agencies are increasingly showing interest in open science methods and transparency [@Strupler_2017].

As @Galison_1997 describes a shift in the practices of physicists, we believe archaeological practice is similarly changing. @Huvila_2018 have explored the use of digital tools on archaeological practices to understand the boundaries of what counts as archaeological, what is merely related to archaeology and what should be excluded from archaeology. Reflecting on @Huvila_2018, the use of code is unquestionably archaeological, since it is one of many tools that archaeologists are using for converting raw data into summaries, visualisations, and insights. These concerns about how digital tools affect what we consider is and is not archaeology intersect with the work of @gieryn1999cultural on boundary construction. In his cultural cartography of science, Gieryn examines boundaries between science generally and varieties of less authoritative non-science. He argues that the boundaries are drawn and redrawn continuously in flexible and sometimes ambiguous ways. Gieryn claims that the cultural authority of science flows from boundary work in professional and political settings where scientists construct a public image for science as a source of credible knowledge, validate their work, and marginalize claims made by their competitors in the scientific community. Boundary work involves attributions of select characteristics to science in order to distinguish it from non-scientific competitors. The increasing voluntary use and sharing of code by researchers, and demands for it by readers and peer reviewers is a form of active boundary work that is shifting the boundary between scientific and non- or less-scientific archaeology. We, as members of this group, argue that the use of code as a research tool, and the sharing of code as a public research product, are increasingly attributes that are being used to distinguish science from less- and un-scientific work. The reason for this is that using code, and making it available for others to inspect, enhances the credibility of knowledge claims and the visibility of those claims.

A related issue here is the _technicity_ of tools, in our case programming languages. @cassirer_form_1930 and @simondon_mode_1958 to define technicity as a term to describe the technology, i.e. tools and machines respectively, that interact with humans and with nature [@hoel_ontological_2013, 188]. Technology is said to own an instrumental kind of logos (Cassierer, see @hoel_ontological_2013, 194) and, in analogy to language, it exercises a certain measure of agency in mediating between humans, nature and technology. The use of a scripting language might exemplify this, as it is not just a technological tool, but a proper "language" as well. Scripts of code are texts that translate data into visualisations and statements about the world, transversing and revitalizing conceptions of the relationship between people and nature, and between people as members of a research community.

In contrast to the concept of technological determinism, which puts technology as a force against the human experience, technicity enfolds technology into 'the human' without letting it lose its 'foreignness' [@hoel_ontological_2013, 190]. Changes in tools will influence how human researchers interact with their objects of interest and other people in their research community. There are three ways is which this can be anticipated for archaeology. First, tools that make the research process more transparent and open might be expected to make the research community more open and inclusive to diverse participants and ideas. Second, using code to 'stand for' or represent the research process will likely increase our awareness of how archaeology itself 'stands for' the human experience in the past, and how it is a representation of the past [cf. @pearson1998beginning]. Third, the code has to be successfully executed to generate a useful result, just as claims about the past have to be successfully engaged with archaeological evidence to count as plausible.  

We do not claim that a Kuhnian paradigm-change is happening in ecology or archaeology: Data- and method-sharing behaviours have been around in archaeology before now [@Lodwick_2019] and do not present newly incommensurate ways of thinking about the subject, in the way that a typical reading of Kuhn's paradigm change concept should. Indeed, social science disciplines such as archaeology may not even be easily susceptible to classical Kuhnian paradigm shifts. This is because high-power tests (i.e. statistical tests with high probabilities of rejecting false null hypotheses) capable of distinguishing between superior and inferior paradigms are rare in the social sciences, such as economics [@Ioannidis_Stanley_Doucouliagos_2017], compared to the physical sciences. Modelling and case studies described by @Akerlof_Michaillat_2018 indicate that among disciplines lacking evidence to routinely strongly discriminate between theories, the chances of getting trapped in an inferior paradigm are high. In this situation, true theories may not be adopted at all and the field is at risk of being captured by false paradigms. 


Although a discipline-wide paradigm shift might be off the table for archaeology, there is a need for methods to share research in a way that is reproducible for others, and that archaeologists are actively exploring tools to make this possible. Our results show that scripting languages and data repositories to share the scripts is a solution that enjoys increasing popularity in the archaeological research community [cf. @marwick_standard_2018]. It has also expanded the 'trading zone' [@Galison_1997] where archaeologists collaborate with specialists in other fields to develop a shared language to get things done. In using scripting languages, archaeologists are working at a trading zone with computer scientists and computational researchers in other fields to coordinate how tools from one domain can be useful in another. Other examples of archaeologists in  trading zones include the use of GIS, network methods, agent-based models, isotope analysis, remote sensing, and DNA analysis to answer archaeological questions. Archaeologists' embrace of these methods may also count as tool-driven revolutions. However, what makes the use of code unique as a tool-driven revolution is that coding is transcendental, it is an universal method with which we can do all, or which can be central to any, of those previously-mentioned approaches. That is why we believe archaeologists should adopt scripted workflows regardless of their usual toolkit and methodological interests.

## 6.1 Making it easier

We acknowledge that learning to use code, if one has not received formal instruction, is not an easy task. A certain familiarity with the computational tools is required to be able to use them not just on a technological basis, but creatively and in full knowledge of their restrictions and ambiguities [@Chrysanthi_2012]. The awareness and the appropriate handling of shortcomings and contexts of the data used in an analysis is also a time- and thought-consuming effort. This effort is required at the beginning of each archaeological research project, and which may be exacerbated by using multiple data sets from varying sources [cf. @Hugget_2015]. 

As with data, preparing code to make it publicly available takes time to ensure that it is fit for others to read and use. Our casual observations of the ways in which archaeologists are using and sharing code show a high degree of variability in code style and organisation, indicating that currently most archaeologists are independently solving problems of how to write and share code through trial and error. We can use concepts from cultural evolution to understand this situation: learning by trial and error is known as guided variation in a cultural evolutionary framework. The dominance of guided variation suggests that using code is not yet widespread enough among archaeologists to propagate due to frequency-dependent biases. Frequency-dependent biases occur when people copy the most abundant variant, in this case the most commonly used tool for analysing data, in the population [cf. @boyd1988culture]. It also suggests that the professional benefits (i.e. the citation effects we describe above) are not yet widely known for code use to propagate due to content biases. Content biases result when some aspect of a variant's content, such as positive citation effects, makes it more likely to be adopted. Finally there may not yet enough highly-visible, prestigous researchers using code for this behaviour due to propagate due to model-based biases [@Rendell_et_al_2011; @boyd1988culture; @henrich2007dual]. This bias is based on imitation of highly prestigous, skilled or successful individuals. Considering the high variability of code using cultural evolutionary concepts, we conclude that there is unrealised potential to improve the efficiency of using and code in archaeology, firstly by converging on some widely-agreed upon conventions that will save researcher's time, and secondly by investing effort in communicating the professional benefits of using code. 

Our contribution to improving the efficiency of using and sharing code is the R package rrtools ('reproducible research tools', https://github.com/benmarwick/rrtools). This package is the result of our analysis of existing practices among archaeologists and other researchers, and our study of best practices and current conventions in scientific computing, described in more detail in @marwick2018packaging. The goal of rrtools is to make it easier for archaeologists and other researchers to use R for research and publication. This package aims to simplify many of the steps needed to write reproducible research papers, and to guide users to best practices with minimal effort. The rrtools package contains functions that create a file structure according to fundamental principles of organising files for research. For example, we keep the data separate from the methods. This means keep the code in a separate directory to the data. We keep the raw data (i.e. field-collected and instrument output) separate from data that is created or derived during the analysis. These two basic principles make it easy to stay organised during a complicated project, and make it easier for a reader to navigate their way through the compendium of files that are shared with the publication. At the heart of the project template provided by rrtools is an RMarkdown document. This is where the report or journal manuscript is written. RMarkdown is a document format that allows the author to combine plain text, R code, and automation of all the usual details of scholarly writing such as citations, captions, and cross-references to tables and figures [@xie2018r]. The unique concept of RMarkdown is that the R code contained in the document will generate the statistical figures and tables when the document is executed (or rendered) into output such as PDF, MS Word or an HTML file. 

The rrtools package contains several functions for the R user to enable a researcher to quickly set up a compendium suitable for writing reproducible research in R. Each of these steps reflects a best practice that has been previously articulated in other fields [e.g. @Wilson_et_al_2017]. We will focus here on the first five, as these are most relevant to most researchers:

- **use_compendium:**  This function creates a new directory for the research project, and creates an R package within this directory. We use the R package structure as the standard for our directory because it is widely recognised by R users [@wickham2015r]. This means that people know where to look for code, where to look for data, and where to look for dependencies and other information.      
- **use_mit_license:** This function creates a copy of the MIT software license to the compendium. Other licenses are also possible, such as GPL, but the MIT license is preferred because it is widely used for research software because of its two important qualities. First, it tells the reader that the author is happy for their code to be reused by others, both in academic and commercial contexts. And second, it tells the reader that the author does not take responsibility for any problems that the reader might have when they use the code. This is important for setting the expectations about the relationship between the author and the reader, regarding the use of code.    
- **use_github:**  This will initiate the use of the Git version control system. This is the current state-of-the-art for version control of any kind of plain text file, including text, code, data, and images [@jones2013git]. This will also create a repository on the GitHub website. Using version control is important because it allows the author to time-travel back to earlier states of their analysis, if they take a dead-end path [@Ram_2013]. It is also makes collaboration smooth because many people can work on one set of files without losing track of the most recent version. Plus it serves as a remote back-up of our work in case of an emergency. The GitHub repository can be kept private if desired, until the work is published.     
- **use_readme_rmd:**  This will create a simple document that is usually the first thing a reader sees when they browse the code files. This document is important because it helps to describe to the reader what to expect in the compendium, and it gives details of how to cite the compendium and engage with it if they want to make changes (e.g. if a reader finds a mistake that needs to be fixed).
- **use_analysis:**  This function creates a set of folders according to the best practices for organising a typical research project [@Wilson_et_al_2017; @noble2009quick]. We recognise that this file structure wont be perfect for every project. But our observations show that it is in wide use, and will suit most projects well. It will at least make the user think about how to organise their project logically, and to make it easier for others to navigate.

# 7. Conclusion

Starting with the discussion of Kuhn's influential work on paradigm shifts in science [@Kuhn_1962], we took inspiration from @Galison_1997 to propose a another explanation of how changes occurs in research communities, emphasising the transformative role of tools. The change we focus on is the use of scripts to document and communicate data analysis. This change will increase the computational reproducibility of archaeology, helping the discipline adhere more closely to the core values of science. The tool with the highest potential to achieve this currently is the R programming language. However, we realise that this will change in time, and in the future newer technologies may replace R. The key point here is that this transformative tool is any open source scripting language. 

We have presented a bibliometric analysis that reveals substantial change in the use of the R programming languages in ecology. Citations patterns show that ecological and evolutionary sciences have strongly embraced R in their publications. Archaeologists have more recently taken up R, but to a much lesser degree, so far, than what we see in the other fields, and most commonly in more scientific aspects of archaeology. We identified an advantage of citing R for researchers as it leads to being referenced more often. We also identified a small, but increasing, set of archaeology papers that use R to make their work fully transparent and reproducible by others. In reflecting on these results, we have noted the technicity of coding in how it mediates between humans, nature and technology. We've proposed that the increasing adoption of coding among archaeologists is a form of active boundary work, shifting the boundary between scientific and unscientific archaeology, and is developing a trading zone between archaeologists and programming specialists such as computer scientists and software engineers as they search for useful tools. Many useful tools have already emerged from this trading zone, including our R package, rrtools, designed to make it easy for researchers to make their research reproducible. We hope this will help to realise some of the potential to make archaeological research more open and reproducible, both within the research community and to the public, as well as speeding the transfer of new results and methods throughout the research community without barriers due to access to resources. Tools emerging from the trading zone are important because they support practices of archaeology that are more faithful to the core values of science.  


We have outlined a positive future for archaeology where research publications are accompanied by code and data, enabling a 'critical self-consciousness' at a community-wide scale, similar to that imagined by @clarke1973archaeology as part of the discipline's 'loss of innocence'. A characteristic of this stage of disciplinary maturity is 'a closer understanding of its internal structure' [@clarke1973archaeology, p. 7], and we can think of no more efficient and intelligible way to communicate the internals of archaeological analyses to other members of the discipline than by encoding the assumptions, logic, and calculations in scripts of an open source programming language. If we accept that that is necessary for the future of the discipline, we must confront two implications. First is the shortage of incentives to motivate the use and sharing of code. Our observation is that many researchers will not change unless required to by gate-keepers at prestigious journals and funding sources. In other research communities we see people in these gate-keeping roles (e.g. in over 5,000 journals and professional organizations) effecting change by adopting the Transparency and Openness Promotion Guidelines that establish community standards of code and data availability that help to align scientific ideals with disciplinary practices [@Nosek_et_al_2015]. Simple forms of signalling, such as badges on papers to indicate that the authors have made code and data available, may also help to shift norms and raise awareness of these desirable behaviours [@Kidwell_et_al_2016]. 

However, cultural change on a community-wide scale, such as a shift to the wide-spread use of code among archaeologists, is most likely to happen via the slow enculturation of professionals as they internalize norms during their formative years, and not via contemporaneous exposure to external cultural influences [@Vaisey_Lizardo_2016]. This means it is unlikely that an established professional archaeologist reading this paper, or ones like it, will be motivated to use code if they were not trained to work with code at the start of their career. The implication here is that the most effective way to stimulate this change is during the first few years of professional training. This means updating our professional training curricula by shifting from a model of creating T-shaped researchers (where the vertical bar on the T represents the depth of specialist skills and expertise in archaeology, and the horizontal bar is the breadth of skills and knowledge of related and intersecting fields) to gamma-shaped researchers [@Fiore_Gartland_2017]. A gamma-shaped researcher has expert-level depth in archaeology, and proficient in other domains that provide skills such as analysing data with a programming language. A gamma-shaped researcher with their MA or PhD in archaeology may also be conversant enough in the language and culture of computer science to have conversations and collaborate in the trading zones described above, but does not need to be an expert in computer science. 

## Acknowledgements

The rrtools package was developed by the 2017 Summer School on Reproducible Research in Landscape Archaeology group at the Freie Universität Berlin (17-21 July). This was funded and jointly organized by Excellence Cluster 264 Topoi, the Collaborative Research Center 1266, and ISAAKiel. A version of this paper was previously presented at the 2018 Computer Applications and Quantitative Methods in Archaeology (CAA) international conference at Tubingen, Germany. Early drafts were improved at the Cologne writing workshop in September 2018, which was supported by the COST Action Arkwork: Archaeological Practices and Knowledge Work in the Digital Environment.

<!-- The following line inserts a page break when the output is MS Word. For page breaks in PDF, use \newpage on its own line.  -->
##### pagebreak

# References
<!-- The following line ensures the references appear here for the MS Word or HTML output files, rather than right at the end of the document (this will not work for PDF files):  -->
<div id="refs"></div>

##### pagebreak

### Colophon

This report was generated on `r Sys.time()` using the following computational environment and dependencies:

```{r colophon, cache = FALSE}
# which R packages and versions?
devtools::session_info()
```

The current Git commit details are:

```{r}
# what commit is this file at? You may need to change the path value
# if your Rmd is not in analysis/paper/
git2r::repository(here::here())
```
